<html>
<head>
  <script src="test_idbfs.js"></script>
  <script>
    function encodeUtf8(s) {
      return unescape(encodeURIComponent(s));
    }

    function decodeUtf8(s) {
      return decodeURIComponent(escape(s));
    }

    var UTF8 = (function () {
      function UTF8() {
      }
      UTF8.getBytes = function (stringValue) {
        var bytes = [];
        for (var i = 0; i < stringValue.length; ++i) {
          bytes.push(stringValue.charCodeAt(i));
        }
        return bytes;
      };

      UTF8.getString = function (utftext) {
        var result = "";
        for (var i = 0; i < utftext.length; i++) {
          result += String.fromCharCode(parseInt(utftext[i], 10));
        }
        return result;
      };

      return UTF8;
    })();


    /*
     var db;
     var request = indexedDB.open("NoWrapper");
     request.onerror = function(event) {
     alert("Why didn't you allow my web app to use IndexedDB?!");
     };
     request.onsuccess = function(event) {
     db = event.target.result;
     //readDefaultWS(av);
     console.log('ndxDB success: db', db);
     };
     */

    var emTxt = encodeUtf8('George');
    var emContents = UTF8.getBytes(emTxt);
    // to go back
    var emTxt2 = UTF8.getString(emContents);
    var jsTxt = decodeUtf8(emTxt2);
    console.log('emTxt', emTxt, '; jsTxt', jsTxt);

    var EmFile = {
      timestamp: Date.now(),
      mode: 33206,
      contents: emContents
    };

    var testCallback = function(err, result) {
      console.log('text call back');
    };

    // console.log('IDBFS', typeof(IDBFS.storeRemoteEntry));

    //IDBFS.getDB('/foo', testCallback);
    console.log('after first getDB');


     IDBFS.storeRemoteEntry(
     IDBFS.getDB('/WS', function(err, result) { console.log('err', err, '; result', result)} ),
     '/WS/G4/entryname.txt',
     EmFile,
     function(err, result){ console.log('err',err, '; result', result);}
     );

  </script>
</head>
</html>