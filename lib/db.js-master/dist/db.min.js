"use strict";!function(a){var b=a.IDBKeyRange||a.webkitIDBKeyRange,c={readonly:"readonly",readwrite:"readwrite"},d=Object.prototype.hasOwnProperty,e=function(a){return a},f=function(){if(!f&&(f=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB||(null===a.indexedDB&&a.shimIndexedDB?a.shimIndexedDB:void 0),!f))throw new Error("IndexedDB required");return f}(),g={},h=Array.isArray,i=function(a,b){var d=this,e=!1;this.getIndexedDB=function(){return a},this.add=function(b){if(e)throw new Error("Database has been closed");for(var d=[],f=arguments.length,g=Array(f>1?f-1:0),i=1;f>i;i++)g[i-1]=arguments[i];g.forEach(function(a){h(a)?d=d.concat(a):d.push(a)});var j=a.transaction(b,c.readwrite),k=j.objectStore(b);return new Promise(function(a,b){var c=this;d.forEach(function(a){var b;if(a.item&&a.key){var c=a.key;a=a.item,b=k.add(a,c)}else b=k.add(a);b.onsuccess=function(b){var c=b.target,d=c.source.keyPath;null===d&&(d="__id__"),Object.defineProperty(a,d,{value:c.result,enumerable:!0})}}),j.oncomplete=function(){return a(d,c)},j.onerror=function(a){a.preventDefault(),b(a)},j.onabort=function(a){return b(a)}})},this.update=function(b){if(e)throw new Error("Database has been closed");for(var d=a.transaction(b,c.readwrite),f=d.objectStore(b),g=[],i=arguments.length,j=Array(i>1?i-1:0),k=1;i>k;k++)j[k-1]=arguments[k];return j.forEach(function(a){h(a)?g=g.concat(a):g.push(a)}),new Promise(function(a,b){var c=this;g.forEach(function(a){if(a.item&&a.key){var b=a.key;a=a.item,f.put(a,b)}else f.put(a)}),d.oncomplete=function(){return a(g,c)},d.onerror=function(a){return b(a)},d.onabort=function(a){return b(a)}})},this.remove=function(b,d){if(e)throw new Error("Database has been closed");var f=a.transaction(b,c.readwrite),g=f.objectStore(b);return new Promise(function(a,b){g["delete"](d),f.oncomplete=function(){return a(d)},f.onerror=function(a){return b(a)}})},this.clear=function(b){if(e)throw new Error("Database has been closed");var d=a.transaction(b,c.readwrite),f=d.objectStore(b);return f.clear(),new Promise(function(a,b){d.oncomplete=function(){return a()},d.onerror=function(a){return b(a)}})},this.close=function(){if(e)throw new Error("Database has been closed");a.close(),e=!0,delete g[b]},this.get=function(b,c){if(e)throw new Error("Database has been closed");var d=a.transaction(b),f=d.objectStore(b),g=f.get(c);return new Promise(function(a,b){g.onsuccess=function(b){return a(b.target.result)},d.onerror=function(a){return b(a)}})},this.query=function(b,c){if(e)throw new Error("Database has been closed");return new j(b,a,c)},this.count=function(b,c){if(e)throw new Error("Database has been closed");var d=a.transaction(b),f=d.objectStore(b);return new Promise(function(a,b){var c=f.count();c.onsuccess=function(b){return a(b.target.result)},d.onerror=function(a){return b(a)}})},[].map.call(a.objectStoreNames,function(a){d[a]={};var b=Object.keys(d);b.filter(function(a){return"close"!==a}).map(function(b){return d[a][b]=function(){for(var c=arguments.length,e=Array(c),f=0;c>f;f++)e[f]=arguments[f];return d[b].apply(d,[a].concat(e))}})})},j=function(a,d,f){var g=this,h=!1,i=function(e,g,i,j,k,l,m){var n=d.transaction(a,h?c.readwrite:c.readonly),o=n.objectStore(a),p=f?o.index(f):o,q=e?b[e].apply(null,g):null,r=[],s=[q],t=0;k=k||null,l=l||[],"count"!==i&&s.push(j||"next");var u=h?Object.keys(h):!1,v=function(a){for(var b=0;b<u.length;b++){var c=u[b],d=h[c];d instanceof Function&&(d=d(a)),a[c]=d}return a};return p[i].apply(p,s).onsuccess=function(a){var b=a.target.result;if("number"==typeof b)r=b;else if(b)if(null!==k&&k[0]>t)t=k[0],b.advance(k[0]);else if(null!==k&&t>=k[0]+k[1]);else{var c=!0,d="value"in b?b.value:b.key;l.forEach(function(a){a&&a.length&&(c=2===a.length?c&&d[a[0]]===a[1]:c&&a[0].apply(void 0,[d]))}),c&&(t++,r.push(m(d)),h&&(d=v(d),b.update(d))),b["continue"]()}},new Promise(function(a,b){n.oncomplete=function(){return a(r)},n.onerror=function(a){return b(a)},n.onabort=function(a){return b(a)}})},j=function(a,b){var c,d,f,g,j,k="next",l="openCursor",m=[],n=null,o=e,p=!1,q=function(){return i(a,b,l,p?k+"unique":k,n,m,o)},r=function(){return n=Array.prototype.slice.call(arguments,0,2),1===n.length&&n.unshift(0),{execute:q}},s=function(){return k=null,l="count",{execute:q}},t=function(){return l="openKeyCursor",{desc:d,execute:q,filter:c,distinct:f,map:j}};return c=function(){return m.push(Array.prototype.slice.call(arguments,0,2)),{keys:t,execute:q,filter:c,desc:d,distinct:f,modify:g,limit:r,map:j}},d=function(){return k="prev",{keys:t,execute:q,filter:c,distinct:f,modify:g,map:j}},f=function(){return p=!0,{keys:t,count:s,execute:q,filter:c,desc:d,modify:g,map:j}},g=function(a){return h=a,{execute:q}},j=function(a){return o=a,{execute:q,count:s,keys:t,filter:c,desc:d,distinct:f,modify:g,limit:r,map:j}},{execute:q,count:s,keys:t,filter:c,desc:d,distinct:f,modify:g,limit:r,map:j}};["only","bound","upperBound","lowerBound"].forEach(function(a){g[a]=function(){return j(a,arguments)}}),this.range=function(a){var b=Object.keys(a).sort();if(1===b.length){var c,d,e=b[0],f=a[e];switch(e){case"eq":c="only";break;case"gt":c="lowerBound",d=!0;break;case"lt":c="upperBound",d=!0;break;case"gte":c="lowerBound";break;case"lte":c="upperBound";break;default:throw new TypeError("`"+e+"` is not valid key")}return new j(c,[f,d])}var g=a[b[0]],h=a[b[1]],i=b.join("-");switch(i){case"gt-lt":case"gt-lte":case"gte-lt":case"gte-lte":return new j("bound",[g,h,"gt"===b[0],"lt"===b[1]]);default:throw new TypeError("`"+i+"` are conflicted keys")}},this.filter=function(){var a=j(null,null);return a.filter.apply(a,arguments)},this.all=function(){return this.filter()}},k=function(a,b,c){"function"==typeof b&&(b=b());var e;for(e in b){var f,g=b[e];f=!d.call(b,e)||c.objectStoreNames.contains(e)?a.currentTarget.transaction.objectStore(e):c.createObjectStore(e,g.key);var h;for(h in g.indexes){var i=g.indexes[h];try{f.index(h)}catch(j){f.createIndex(h,i.key||h,Object.keys(i).length?i:{unique:!1})}}}},l=function(a,b,c,d){var e=a.target.result,f=new i(e,b);return g[b]=e,Promise.resolve(f)},m={version:"0.11.0",open:function(a){return new Promise(function(b,c){if(g[a.server])l({target:{result:g[a.server]}},a.server,a.version,a.schema).then(b,c);else{var d=f.open(a.server,a.version);d.onsuccess=function(d){return l(d,a.server,a.version,a.schema).then(b,c)},d.onupgradeneeded=function(b){return k(b,a.schema,b.target.result)},d.onerror=function(a){return c(a)}}})},"delete":function(a){return new Promise(function(b,c){var d=f.deleteDatabase(a);d.onsuccess=function(){return b()},d.onerror=function(a){return c(a)},d.onblocked=function(a){return c(a)}})}};"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=m:"function"==typeof define&&define.amd?define(function(){return m}):a.db=m}(window);
//# sourceMappingURL=db.min.js.map